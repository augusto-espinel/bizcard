# Copilot instructions ‚Äî AR business card (concise)

## Purpose
Short guidance for AI agents working on this repo: modify A-Frame + MindAR scenes, add interactive buttons, and debug gyro/shader behavior for mobile AR.

## Quick start & testing ‚ö°
- This is a static site. Serve locally (HTTPS or localhost required for DeviceOrientation):
  - python -m http.server 8000
- Open `index.html` on a mobile device (iOS requires explicit permission via the start flow).
- Use `debug.html` to view on-screen logs and `debug2.html` for stencil/mask experiments.

## Key files & components üîß
- `index.html` ‚Äî main experience (start flow, gyro mapping, shader + UI buttons)
- `debug.html` ‚Äî on-screen logs and simple loading checks
- `debug2.html` ‚Äî stencil / viewport masking experiments
- `targets.mind` ‚Äî binary MindAR target (DO NOT edit by hand)
- Components to know: `link-handler`, `interaction-sync` (permission + orientation ‚Üí `uPan`/`uTilt`, computes `uDist`), `neural-parallax` (shader), `stencil-setup`, `stl-loader`

## Project-specific patterns (do this, not generic advice) ‚úÖ
- Interactive elements: add `class="clickable"` + `link-handler data-url="..."`. Example:
  ```html
  <a-entity class="clickable" link-handler data-url="https://example.com">
    <a-entity class="bg-box"></a-entity>
  </a-entity>
  ```
- Start flow: `#start-btn` triggers DeviceOrientation permission (via `DeviceOrientationEvent.requestPermission()` on iOS). On success the overlay is hidden directly (`document.getElementById('overlay').style.display = 'none'`).
- Shaders: `neural-parallax` exposes `uPan`, `uTilt`, `uDist`, `uTime`, `uColor`. `interaction-sync` maps orientation ‚Üí `uPan`/`uTilt` and computes a proximity `uDist` (used to fade/zoom effects). Clamp/smooth vertical angles to avoid poles.
- Stencil masking: follow `debug2.html` pattern ‚Äî mask plane (renderOrder=1, colorWrite=false, Replace) + content sphere (Equal stencil test). `stencil-setup` shows exact material flags.
- Access Three.js material when needed: `this.el.getObject3D('mesh').material`. Use this when toggling stencil/depth/material properties dynamically.

## Assets & integration notes üîó
- Textures used remotely should include `crossorigin="anonymous"` (see `debug.html` where image asset uses `crossorigin` and has an `onerror` handler to surface load failures).
- `targets.mind` is generated by MindAR Studio; update via the studio and drop the binary in repo.
- `stl-loader` is used to load local `.stl` objects (see `illusion_perspective.stl` in `index.html`). It centers & scales geometry after parsing ‚Äî watch `scale` and `center()` behavior when swapping models.

## Testing checklist when changing visuals or interactions ‚úÖ
- Run on a physical mobile device (or use `debug.html` for desktop-safe checks).
- Verify `targetFound` / `targetLost` events fire.
- For panorama/shader changes, adjust shader uniforms (e.g., `uPan`, `uTilt`, `uDist`) and vertical clamps and test in `debug2.html` if using masks.

## PR & development conventions ‚úçÔ∏è
- Keep UI interactions built with `.clickable` + `link-handler` for consistency.
- No build system ‚Äî small changes, test locally via a static server.

---
If anything in these notes is unclear or you'd like more examples (e.g., how `gyro-sync` maps orientation to `uPan`), tell me which section to expand.
